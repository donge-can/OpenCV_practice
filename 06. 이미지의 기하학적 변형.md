### 06. ì´ë¯¸ì§€ì˜ ê¸°í•˜í•™ì  ë³€í˜•

> cv2.getPerspectiveTransform()
>
> ì‚¬ì´ì¦ˆ ë³€ê²½(Scaling), ìœ„ì¹˜ë³€ê²½(Translation), íšŒì „(Rotation)

----

#### 1. Transformations

- `ê°•ì²´ë³€í™˜ Ridid-Body` : í¬ê¸° ë° ê°ë„ê°€ ë³´ì¡´ (ì˜ˆ - Translation, Rotation)
- `ìœ ì‚¬ë³€í™˜ Similarity` : í¬ê¸°ëŠ” ë³€í•˜ê³  ê°ë„ëŠ” ë³´ì¡´ (ì˜ˆ - Scaling)
- `ì„ í˜•ë³€í™˜ Linear` : Vector ê³µê°„ì—ì„œì˜ ì´ë™
- `Affine` : ì„ í˜•ë³€í™˜ê³¼ ì´ë™ë³€í™˜ê¹Œì§€ í¬í•¨. ì„ ì˜ ìˆ˜í‰ì„±ì€ ìœ ì§€(ì˜ˆ - ì‚¬ê°í˜• -> í‰í–‰ì‚¬ë³€í˜•)
- `Perspective` : `Affine` ë³€í™˜ì— ìˆ˜í‰ì„±ë„ ìœ ì§€ë˜ì§€ ì•ŠìŒ. ì›ê·¼ ë³€í™˜

<br>

#### 1.1 Scaling

- ì´ë¯¸ì§€ì˜ ì‚¬ì´ì¦ˆê°€ ë³€í•˜ëŠ” ê²ƒ
- `cv2.resize(img, dsize, fx, fy, interpolation)` 
  - ì‚¬ì´ì¦ˆê°€ ë³€í•˜ë©´ pixel ì‚¬ì´ì˜ ê°’ì„ ê²°ì •í•´ì•¼ í•˜ëŠ”ë°, ì´ë•Œ ì‚¬ìš©í•˜ëŠ” ê²ƒì„ ë³´ê°„ë²• Interpolation method ë¼ê³  í•œë‹¤.
  - `img` : Image
  - `dsize` : Manual Size. (width, height) == ê°€ë¡œ, ì„¸ë¡œ í˜•íƒœì˜ tuple
  - `fx` : ê°€ë¡œ ì‚¬ì´ì¦ˆì˜ ë°°ìˆ˜. 2ë°°ë¡œ í¬ê²Œí•˜ë ¤ë©´ 2. ë°˜ìœ¼ë¡œ ì¤„ì´ë ¤ë©´ 0.5
  - `fy` : ì„¸ë¡œ ì‚¬ì´ì¦ˆì˜ ë°°ìˆ˜
  - `interpolation` : ë³´ê°„ë²•
    - `cv2.INTER_AREA` : ì‚¬ì´ì¦ˆë¥¼ ì¤„ì¼ ë•Œ
    - `cv2.INTER_CUBIC` , `cv2.INTER_LINEAR` : ì‚¬ì´ì¦ˆë¥¼ í¬ê²Œí•  ë•Œ

<br>

#### 1.2 Translation

- ì´ë¯¸ì§€ì˜ ìœ„ì¹˜ ë³€ê²½
- `cv2.warpAffine(src, M, dsize)`
  - `src` : image
  - `M` : ë³€í™˜ í–‰ë ¬
  - `dsize(tuple)` : (width, height) , output image size(columns, rows)
- ì˜ˆì‹œ

```python
import cv2 
import numpy as np 
import matplotlib.pyplot as plt 

image = cv2.imread('img/image.jpg')

height, width = image.shape[:2]

M = np.float32([[1, 0, 200], [0, 1, 300]])
# ë³€í™˜ í–‰ë ¬, Xì¶•ìœ¼ë¡œ 200, Yì¶•ìœ¼ë¡œ 300 ì´ë™


dst = cv2.warpAffine(image, M, (width, height))

plt.imshow(cv2.cvtColor(dst, cv2.COLOR_BGR2RGB))
plt.show()
```

- ê²°ê³¼

![](C:\Users\user\AppData\Roaming\Typora\typora-user-images\image-20200110084556807.png)

<br>

#### 1.3 Rotaion

- ë¬¼ì²´ë¥¼ í‰ë©´ìƒì˜ í•œ ì ì„ ì¤‘ì‹¬ìœ¼ë¡œ ğœƒ ë§Œí¼ íšŒì „í•˜ëŠ” ë³€í™˜
- ì´ë¯¸ì§€ íšŒì „ì„ ìœ„í•œ ë³€í™˜ í–‰ë ¬ ë§Œë“¤ê¸°
  - `cv2.getRotationMatrix2D(center, angle, scale)` - **ë³€í™˜í–‰ë ¬**
    - `center` : ì´ë¯¸ì§€ì˜ ì¤‘ì‹¬ ì¢Œí‘œ (x, y)
    - `angle` : íšŒì „ ê°ë„ , ì–‘ì˜ ê°ë„ëŠ” ì‹œê³„ ë°˜ëŒ€ ë°©í–¥ìœ¼ë¡œ íšŒì „í•¨
    - `scale` : scale factor(í™•ëŒ€/ ì¶•ì†Œ ë¹„ìœ¨)
- ì˜ˆì‹œ(`cv2.getrotationMatrix2D`ë¡œ ë³€í™˜í–‰ë ¬ì„ ë§Œë“  í›„, `cv2.warpAffine` ì— ì ìš©í•˜ì—¬ ì´ë¯¸ì§€ë¥¼ íšŒì „ì‹œí‚´)

```python
img = cv2.imread('img/image.jpg')

# í–‰ê³¼ ì—´ ì • 
rows, cols = img.shape[0:2]

# ë³€í™˜ í–‰ë ¬ ìƒì„±
m90 =cv2.getRotationMatrix2D((rows / 2, cols / 2), 90, 0.5)
# ì´ë¯¸ì§€ì˜ ì¤‘ì‹¬ ì¢Œí‘œ (rows/2, cols/2)
# íšŒì „ ê°ë„ : 90 -> ì‹œê³„ ë°˜ëŒ€ ë°©í–¥ìœ¼ë¡œ 90ë„ ë§Œí¼ íšŒì „
# scale : 0.5 (0.5ë¡œ ë¹„ìœ¨ ì¡°ì •)

# ì´ë¯¸ì§€ íšŒì „ - m90ë³€í™˜í–‰ë ¬ ì ìš©
dst = cv2.warpAffine(img, m90, (rows, cols)) 

plt.imshow(cv2.cvtColor(dst, cv2.COLOR_BGR2RGB))
plt.show() 
```

- ê²°ê³¼

![](C:\Users\user\AppData\Roaming\Typora\typora-user-images\image-20200110085154780.png)

#### 1.4 Affine Transformation ì–´í•€ ë³€í™˜

- ì–´í•€ ë³€í™˜ì€ ì„ ì˜ í‰í–‰ì„±ì€ ìœ ì§€ê°€ ë˜ë©´ì„œ ì´ë¯¸ì§€ë¥¼ ë³€í™˜í•˜ëŠ” ì‘ì—…
- ì´ë™, í™•ëŒ€, Scale, ë°˜ì „ê¹Œì§€ í¬í•¨ëœ ë³€í™˜
- Affine ë³€í™˜ì„ ìœ„í•´ì„œ 3ê°œì˜ Matchê°€ ë˜ëŠ” ì ì´ ìˆìœ¼ë©´ ë³€í™˜ í–‰ë ¬ì„ êµ¬í•  ìˆ˜ ìˆìŒ

- `cv2.getaffineTransform(pts1, pts2)`  - **ë³€í™˜í–‰ë ¬**
  - ë³€í™˜ ì „ê³¼ ë³€í™˜ í›„ì˜ 3ê°œì˜ ì ì„ ì§ ì§€ì–´ ë§¤í•‘í•˜ì—¬ ë³€í™˜í–‰ë ¬ì„ ê±°ê¾¸ë¡œ ê³„ì‚°í•œë‹¤
  - `pts1` : ë³€í™˜ ì „ ì˜ìƒì˜ ì¢Œí‘œ 3ê°œ, 3x2 numpy ë°°ì—´ (float32)
  - `pts2` : ë³€í™˜ í›„ ì˜ìƒì˜ ì¢Œí‘œ 3ê°œ, pts1ê³¼ ë™ì¼
  - `cv2.getaffineTransform(pts1, pts2)`  : ë³€í™˜í–‰ë ¬, 2x3 í–‰ë ¬
- ì˜ˆì‹œ (`cv2.getaffineTransform()` ìœ¼ë¡œ ë³€í™˜í–‰ë ¬ ìƒì„± í›„, `cv2.warpAffine()` ë¡œ ì–´í•€ ë³€í™˜ ì‹¤í–‰)

```python
import cv2
import numpy as np
from matplotlib import pyplot as plt

img = cv2.imread('img/fish.jpg')
rows, cols = img.shape[:2]

# ë³€í™˜ ì „, í›„ ê° 3ê°œì˜ ì¢Œí‘œ ìƒì„±
pts1 = np.float32([[100, 50], [200, 50], [100, 200]])
pts2 = np.float32([[80, 70], [210, 60], [250, 120]])

# ë³€í™˜ ì „ ì¢Œí‘œë¥¼ ì´ë¯¸ì§€ì— í‘œì‹œ
cv2.circle(img, (100,50), 5, (255,0), -1)
cv2.circle(img, (200,50), 5, (0,255,0), -1)
cv2.circle(img, (100,200), 5, (0,0,255), -1)

#ì§ì§€ì€ 3ê°œì˜ ì¢Œí‘œë¡œ ë³€í™˜ í–‰ë ¬ ìƒì„±
mtrx = cv2.getAffineTransform(pts1, pts2)

# ì–´í•€ ë³€í™˜ ì ìš©
dst = cv2.warpAffine(img, mtrx, (int(cols*1.5), rows))
# img, ë³€í™˜í–‰ë ¬, ouput image size(tuple)

# ê²°ê³¼ ì¶œë ¥
plt.imshow(cv2.cvtColor(img, cv2.COLOR_BGR2RGB))
plt.show()
plt.imshow(cv2.cvtColor(dst, cv2.COLOR_BGR2RGB))
plt.show()

```

- ê²°ê³¼

![](C:\Users\user\AppData\Roaming\Typora\typora-user-images\image-20200110102113329.png)



#### 1.5 Perspective Transformation ì›ê·¼ ë³€í™˜

- ì§ì„ ì˜ ì„±ì§ˆë§Œ ìœ ì§€ê°€ ë˜ê³ , ì„ ì˜ í‰í–‰ì„±ì€ ìœ ì§€ê°€ ë˜ì§€ ì•ŠëŠ” ë³€í™˜
- ê¸°ì°¨ê¸¸ì€ ì„œë¡œ í‰í–‰í•˜ì§€ë§Œ, ì›ê·¼ë³€í™˜ì„ ê±°ì¹˜ë©´ í‰í–‰ì„±ì€ ìœ ì§€ ë˜ì§€ ëª»í•˜ê³  í•˜ë‚˜ì˜ ì ì—ì„œ ë§Œë‚˜ëŠ” ê²ƒ ì²˜ëŸ¼ ë³´ì„
- 4 ê°œì˜ Point ì˜ Input ê°’ê³¼ ì´ë™í•  output point ê°€ í•„ìš”í•¨
- `cv2.getPerspectiveTransform(pts1, pts2)`  - **ë³€í™˜í–‰ë ¬**
  - ë³€í™˜ ì „ê³¼ í›„ë¥¼ ì§ì§“ëŠ” 4ê°œì˜ ë§¤í•‘ ì¢Œí‘œë§Œ ì§€ì •í•´ì£¼ë©´ ì›ê·¼ ë³€í™˜ì— í•„ìš”í•œ 3 X 3 ë³€í™˜ í–‰ë ¬ì„ ê³„ì‚°í•œë‹¤.
  - `pts1` : ë³€í™˜ ì´ì „ ì˜ìƒì˜ ì¢Œí‘œ 4ê°œ, 4 x 2 numpy ë°°ì—´(float32)
  - `pts2` : ë³€í™˜ ì´í›„ ì˜ìƒì˜ ì¢Œí‘œ 4ê°œ, 4 x 2 numpy ë°°ì—´(float32)
- `cv2.warpPerspective(img, mtrx, (cols, rows))` 
  - ì›ê·¼ ë³€í™˜ ì ìš© í•¨ìˆ˜
  - `cv2.warpAffine()` í•¨ìˆ˜ì™€ ê¸°ëŠ¥ ë™ì¼

```python
img = cv2.imread("img/fish.jpg")
rows, cols = img.shape[:2]

# ì›ê·¼ ë³€í™˜ ì „ í›„ 4ê°œ ì¢Œí‘œ
pts1 = np.float32([[0,0], [0,rows], [cols, 0], [cols,rows]])
pts2 = np.float32([[100,50], [10,rows-50], [cols-100, 50], [cols-10,rows-50]])

# ë³€í™˜ ì „ ì¢Œí‘œë¥¼ ì›ë³¸ ì´ë¯¸ì§€ì— í‘œì‹œ
cv2.circle(img, (0,0), 10, (255,0,0), -1)
cv2.circle(img, (0,rows), 10, (0,255,0), -1)
cv2.circle(img, (cols,0), 10, (0,0,255), -1)
cv2.circle(img, (cols,rows), 10, (0,255,255), -1)

# ì›ê·¼ ë³€í™˜ í–‰ë ¬ ê³„ì‚°
mtrx = cv2.getPerspectiveTransform(pts1, pts2)

# ì›ê·¼ ë³€í™˜ ì ìš©
dst = cv2.warpPerspective(img, mtrx, (cols, rows))
# cv2.warpAffine(img, mtrx, (cols, rows)) ì™€ ë™ì¼í•œ ê¸°ëŠ¥
# ouput image size (cols, rows)


plt.imshow(cv2.cvtColor(img, cv2.COLOR_BGR2RGB))
plt.show()
plt.imshow(cv2.cvtColor(dst, cv2.COLOR_BGR2RGB))
plt.show()
```

- ê²°ê³¼

![](C:\Users\user\AppData\Roaming\Typora\typora-user-images\image-20200110110515154.png)



